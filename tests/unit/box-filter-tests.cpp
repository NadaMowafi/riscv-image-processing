#include "BoxFilter.h"
#include <gtest/gtest.h>
#include <vector>
#include <stdexcept>

using namespace std;

TEST(BoxFilterTest, CorrectOutput) {
    vector<vector<vector<int>>> inputImg = {
        {{10, 20, 30}, {20, 30, 40}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}},
        {{15, 25, 35}, {25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {55, 65, 75}},
        {{20, 30, 40}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {60, 70, 80}},
        {{25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {55, 65, 75}, {65, 75, 85}},
        {{30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {60, 70, 80}, {70, 80, 90}}
    };

    int kernelSize = 3;
    vector<vector<vector<int>>> expectedOutput = {
        {{7, 12, 16}, {15, 21, 28}, {21, 28, 35}, {28, 35, 41}, {21, 25, 29}},
        {{13, 19, 26}, {25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {33, 39, 46}},
        {{16, 23, 29}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {36, 43, 49}},
        {{19, 26, 33}, {35, 45, 55}, {45, 55, 65}, {55, 65, 75}, {39, 46, 53}},
        {{14, 18, 23}, {25, 31, 38}, {31, 38, 45}, {38, 45, 51}, {27, 32, 36}}
    };

    vector<vector<vector<int>>> output = BoxFilter(inputImg, kernelSize);
    EXPECT_EQ(output, expectedOutput);
}

TEST(BoxFilterTest, IncorrectOutput) {
    vector<vector<vector<int>>> inputImg = {
        {{10, 20, 30}, {20, 30, 40}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}},
        {{15, 25, 35}, {25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {55, 65, 75}},
        {{20, 30, 40}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {60, 70, 80}},
        {{25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {55, 65, 75}, {65, 75, 85}},
        {{30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {60, 70, 80}, {70, 80, 90}}
    };

    int kernelSize = 3;
    //Changed one value for checking not equal
    vector<vector<vector<int>>> incorrectOutput = {
        {{7, 12, 16}, {15, 21, 28}, {21, 28, 35}, {28, 35, 41}, {21, 25, 29}},
        {{13, 19, 26}, {25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {33, 39, 46}},
        {{16, 23, 29}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {36, 43, 49}},
        {{19, 26, 33}, {35, 11, 55}, {45, 55, 65}, {55, 65, 75}, {39, 46, 53}},
        {{14, 18, 23}, {25, 31, 38}, {31, 38, 45}, {38, 45, 51}, {27, 32, 36}}
    };

    vector<vector<vector<int>>> output = BoxFilter(inputImg, kernelSize);
    EXPECT_NE(output, incorrectOutput);
}

TEST(BoxFilterTest, InvalidKernelSize) {
    vector<vector<vector<int>>> inputImg = {
        {{10, 20, 30}, {20, 30, 40}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}},
        {{15, 25, 35}, {25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {55, 65, 75}},
        {{20, 30, 40}, {30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {60, 70, 80}},
        {{25, 35, 45}, {35, 45, 55}, {45, 55, 65}, {55, 65, 75}, {65, 75, 85}},
        {{30, 40, 50}, {40, 50, 60}, {50, 60, 70}, {60, 70, 80}, {70, 80, 90}}
    };

    int kernelSize = 4; 
    BoxFilter(inputImg, kernelSize); //Should throw an exception
}

int main() {
    ::testing::InitGoogleTest();
    return RUN_ALL_TESTS();
}
